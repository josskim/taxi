<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>íƒì‹œ í˜¸ì¶œ</title>
  <style>
    /* ìœ„ 2ë²ˆ ìŠ¤íƒ€ì¼ ë³µì‚¬ ë¶™ì—¬ë„£ê¸° */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 480px;
      margin: 40px auto;
      padding: 20px;
      background: #f9faff;
      color: #333;
    }

    h2 {
      text-align: center;
      margin-bottom: 24px;
    }

    input, button {
      display: block;
      width: 100%;
      padding: 14px 20px;
      margin-bottom: 16px;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }

    input:focus {
      border-color: #0078d7;
      outline: none;
    }

    button {
      background-color: #0078d7;
      border: none;
      color: white;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 120, 215, 0.3);
    }

    button:hover {
      background-color: #005a9e;
    }

    #msg {
      text-align: center;
      font-weight: 500;
      min-height: 24px;
      color: #e03e2f;
    }
  </style>
</head>
<body>


<div id="map" style="height:400px;"></div>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCiNAdY2FCksg34Zy2PJmhSoclaIW-XFWI&callback=initMap" async defer></script>
<script>
let map;
let markers = {};
let infowindow;

function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    zoom: 17, //ê¸°ì¡´ 14 â†’ 16ìœ¼ë¡œ ìƒìŠ¹ í•´ì„œ 4ë°°ë” í™•ëŒ€í•¨.  êµ¬ê¸€ ë§µ ì¤Œ ë ˆë²¨ì—ì„œ 1 ì¦ê°€í•˜ë©´ ë³´ì´ëŠ” ë²”ìœ„ê°€ ëŒ€ëµ 2ë°° ì‘ì•„ì§€ë¯€ë¡œ 2ë‹¨ê³„ ì˜¬ë¦¬ë©´ ì•½ 4ë°° ë” í™•ëŒ€ëœ ì…ˆì…ë‹ˆë‹¤.
    center: {lat: 35.7384, lng: 128.7334}
  });

  infowindow = new google.maps.InfoWindow();

  loadGPS();
  setInterval(loadGPS, 3000);
}

function getOffset(index) {
  const offset = 0.00005;
  return (index % 5) * offset;
}

function loadGPS() {
  if (!map) {
    console.warn("Map is not initialized yet");
    return;
  }

  fetch('/gps')
    .then(r => r.json())
    .then(data => {
      let i = 0;
      for (let id in data) {
        let baseLat = data[id].lat;
        let baseLng = data[id].lng;

        let pos = {
          lat: baseLat + getOffset(i),
          lng: baseLng + getOffset(i + 2)
        };

        let color = "#ff3b3b";

        if (!markers[id]) {
          let marker = new google.maps.Marker({
            position: pos,
            map: map,
            label: {
              text: id.substring(0, 1),
              color: color,
            },
            icon: {
              path: google.maps.SymbolPath.CIRCLE,
              scale: 10,
              fillColor: color,
              fillOpacity: 1,
              strokeColor: "black",
              strokeWeight: 2,
            }
          });

          marker.addListener('click', () => {
            infowindow.setContent(id + " ìœ„ì¹˜");
            infowindow.open(map, marker);
          });

          markers[id] = marker;
        } else {
          markers[id].setPosition(pos);
        }

        i++;
      }
    })
    .catch(e => console.error("GPS load error:", e));
}

</script>





<h2>ğŸš• íƒì‹œ í˜¸ì¶œ</h2>

<input id="from" type="text" placeholder="ì¶œë°œì§€ ì…ë ¥" autocomplete="off" />
<input id="to" type="text" placeholder="ë„ì°©ì§€ ì…ë ¥" autocomplete="off" />
<input id="phone" type="tel" placeholder="ì „í™”ë²ˆí˜¸ ì…ë ¥" autocomplete="off" />

<button onclick="send()">íƒì‹œ í˜¸ì¶œí•˜ê¸°</button>

<p id="msg"></p>

<script>
  const fromInput = document.getElementById("from");
  const toInput = document.getElementById("to");
  const phoneInput = document.getElementById("phone");
  const msg = document.getElementById("msg");

  function send() {
    const from = fromInput.value.trim();
    const to = toInput.value.trim();
    const phone = phoneInput.value.trim();

    if (!from || !to || !phone) {
      msg.style.color = "#e03e2f";
      msg.innerText = "ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      return;
    }

    fetch('/request', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ from, to, phone })
    })
      .then(r => r.text())
      .then(t => {
        msg.style.color = "#0078d7";
        msg.innerText = t;

        fromInput.value = "";
        toInput.value = "";
        phoneInput.value = "";
      })
      .catch(e => {
        msg.style.color = "#e03e2f";
        msg.innerText = "ì„œë²„ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        console.error(e);
      });
  }
</script>

</body>
</html>