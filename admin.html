<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì ‘ìˆ˜ ê´€ë¦¬</title>
<link rel="stylesheet" href="style.css?v=1.2" />
<style>
body { font-family: Arial; max-width: 700px; margin: 30px auto; padding: 0 10px; }
.card {
  border:1px solid #ccc;
  padding:15px;
  margin:10px 0;
}
.card.completed {
  background-color: #e0e0e0;  /* ì—°í•œ ê·¸ë ˆì´ ì»¬ëŸ¬ */
  color: #777;               /* íšŒìƒ‰ ìŒì˜ìœ¼ë¡œ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ */
  border-color: #999;         /* í…Œë‘ë¦¬ë„ ì—°í•˜ê²Œ */
}
button { padding:8px 12px; }
</style>

</head>
<body>

<h2>ğŸ“‹ ì ‘ìˆ˜ ëª©ë¡..</h2>

<h3>ìœ„ì¹˜</h3>

<div class="search-box">
      <input id="searchName" type="text" placeholder="ë“±ë¡ ì´ë¦„ ê²€ìƒ‰ (ì˜ˆ: ìŠ¤í…Œì´ë‚¨ì²œ)" class="input" onkeyup="if(window.event.keyCode==13){searchDriver()}" />
      <button onclick="searchDriver()" style="white-space: nowrap; width: 80px;">ê²€ìƒ‰</button>
</div>
<div id="map" style="height:400px;"></div>

<div id="msg" style="min-height: 24px; margin-bottom: 10px; color:green;"></div>
<div id="list"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCiNAdY2FCksg34Zy2PJmhSoclaIW-XFWI&callback=initMap" async defer></script>
<script src="map-script.js?v=2.2"></script>
<script src="form.js?v=1.2"></script>
<script>
function load() {
  fetch('/list')
  .then(r => r.json())
  .then(data => {
    let html = '';
    data.forEach((r, i) => {
      html += `
      <div class="card" data-index="${i}">
        <b>ì¶œë°œ:</b> ${r.from} <br>
        <b>ë„ì°©:</b> ${r.to} <br>
        <b>ì „í™”:</b> ${r.phone} <br><br>
        <button onclick="done(${i}, this)">ì™„ë£Œ</button>
      </div>`;
    });
    list.innerHTML = html;
  });
}

const msg = document.getElementById('msg');

function done(i, btn) {
  fetch('/done', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({index: i})
  })
  .then(r => r.text())
  .then(text => {
    // ì™„ë£Œ ë©”ì‹œì§€ í•„ìš” ì‹œ í‘œì‹œ ë˜ëŠ” console.log(text);

    // ë²„íŠ¼ì´ ì†í•œ card divë¥¼ ì°¾ì•„ ì™„ë£Œ ìŠ¤íƒ€ì¼ ì ìš©
    const cardDiv = btn.closest('.card');
    if(cardDiv){
      cardDiv.classList.add('completed');
      // ë²„íŠ¼ ë¹„í™œì„±í™” í•´ë²„ë ¤ë„ ì¢‹ìŒ
      btn.disabled = true;
      btn.innerText = "ì™„ë£Œë¨";
    }
  })
  .catch(e => {
    console.error(e);
    alert('ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  });
}

setInterval(load, 2000);
load();
</script>

</body>
</html>