<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ê¸°ì‚¬ ìœ„ì¹˜ ì „ì†¡</title>
</head>
<body>

<h2>ğŸš• ê¸°ì‚¬ ìœ„ì¹˜ ì „ì†¡..</h2>

<div id="setup" style="display:none;">
  <p>ê¸°ì‚¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</p>
  <input id="name" placeholder="ì˜ˆ: ìŠ¤í…Œì´ë‚¨ì²œ">
  <button onclick="saveName()">í™•ì¸</button>
</div>

<p id="status"></p>
<button onclick="changeName()">ê¸°ì‚¬ ì´ë¦„ ë³€ê²½</button>

<script>
let driverId = localStorage.getItem("driverId");

function saveName(){
  driverId = document.getElementById("name").value.trim();
  if(driverId === "") return;

  localStorage.setItem("driverId", driverId);
  setup.style.display = "none";
  startGPS();   // ì´ë¦„ ì €ì¥ í›„ì—ë§Œ GPS ì‹œì‘
}

function changeName(){
  localStorage.removeItem("driverId");
  location.reload();
}

function startGPS(){
  if(!driverId){
    setup.style.display = "block";
    return;   // ğŸ”¥ ì´ë¦„ ì—†ìœ¼ë©´ GPS ì ˆëŒ€ ì‹œì‘ ì•ˆí•¨
  }

  status.innerText = "ê¸°ì‚¬ ["+driverId+"] ìœ„ì¹˜ ì „ì†¡ì¤‘";

  setInterval(()=>{
    navigator.geolocation.getCurrentPosition(pos=>{
      fetch('/gps', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          id: driverId,
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        })
      });
    });
  }, 3000);
}

startGPS();
</script>

</body>
</html>
