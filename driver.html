<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ê¸°ì‚¬ ìœ„ì¹˜ ì „ì†¡</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="container" style="max-width:600px; margin:0 auto; padding:8px;">
  <h2>ğŸš• ê¸°ì‚¬ ìœ„ì¹˜ ì „ì†¡</h2>

  <div id="setup" class="card" style="display:none;">
    <p style="margin:0 0 8px;">ê¸°ì‚¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</p>
    <input id="name" placeholder="ì˜ˆ: ìŠ¤í…Œì´ë‚¨ì²œ" class="input" />
    <button onclick="saveName()">í™•ì¸</button>
  </div>

  <p id="status" class="card" style="margin-top:8px; padding:10px 12px;"></p>
  <button class="secondary" onclick="changeName()">ê¸°ì‚¬ ì´ë¦„ ë³€ê²½</button>
</div>

<script>
let driverId = localStorage.getItem("driverId");

function saveName(){
  driverId = document.getElementById("name").value.trim();
  if(driverId === "") return;

  localStorage.setItem("driverId", driverId);
  document.getElementById("setup").style.display = "none";
  startGPS();   // ì´ë¦„ ì €ì¥ í›„ì—ë§Œ GPS ì‹œì‘
}

function changeName(){
  localStorage.removeItem("driverId");
  location.reload();
}

function startGPS(){
  if(!driverId){
    document.getElementById("setup").style.display = "block";
    return;   // ğŸ”¥ ì´ë¦„ ì—†ìœ¼ë©´ GPS ì ˆëŒ€ ì‹œì‘ ì•ˆí•¨
  }

  document.getElementById("status").innerText = "ê¸°ì‚¬ ["+driverId+"] ìœ„ì¹˜ ì „ì†¡ì¤‘";

  setInterval(()=>{
    navigator.geolocation.getCurrentPosition(pos=>{
      fetch('/gps', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          id: driverId,
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        })
      });
    });
  }, 3000);
}

startGPS();
</script>

</body>
</html>